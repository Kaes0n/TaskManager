# Task Manager

Версия: 1.0.0

## Требования
- Python 3.8 или выше
- Доступ к файловой системе для создания БД и лог-файлов
- 100 МБ свободного места на диске

## Описание
Task Manager - это веб-приложение для планирования и выполнения Python-скриптов по расписанию. 

### Основные функции:
- Создание задач с Python-кодом
- Три типа расписания:
  - Однократное выполнение в указанное время
  - Ежедневное выполнение в указанное время
  - Выполнение с интервалом в N дней
- История выполнения задач
- Возможность ручного запуска задач
- Редактирование существующих задач
- Просмотр логов выполнения

## Установка и запуск

### 1. Создание виртуального окружения
Создаем виртуальное окружение
python -m venv venv
Активируем виртуальное окружение
Для Windows:
venv\Scripts\activate
Для Linux/Mac:
source venv/bin/activate

### 2. Установка зависимостей
pip install flask==3.0.0, flask-sqlalchemy==3.1.1, flask-apscheduler, SQLAlchemy

### 3. Подготовка окружения
mkdir tasks, mkdir templates

# Для Windows, если возникают проблемы с правами доступа:
icacls tasks /grant:r "%USERNAME%":(OI)(CI)F /grant:r "Users":(OI)(CI)RX
#Аналогичная команда для Linux/Mac:
chmod -R 755 tasks


### 4. Запуск приложения
python task.py

Приложение будет доступно по адресу: http://127.0.0.1:5000

### 5. Проверка работоспособности
1. Откройте браузер и перейдите по адресу http://127.0.0.1:5000
2. Создайте тестовую задачу с простым кодом (например, print("Test"))
3. Убедитесь, что в директории tasks появился файл с кодом
4. Проверьте, что появились файлы БД (taskmanager.db и jobs.sqlite)

## Структура проекта
taskmanager/
├── task.py                # Основной файл приложения
├── taskmanager.db         # База данных задач и истории
├── jobs.sqlite            # База данных планировщика
├── task_manager.log       # Лог-файл
├── tasks/                 # Директория с файлами задач
└── templates/             # HTML шаблоны
    ├── index.html         # Главная страница
    ├── create_task.html   # Создание задачи
    ├── edit_task.html     # Редактирование задачи
    └── history.html       # История выполнения

## Безопасность
- Приложение предназначено для локального использования
- Не рекомендуется открывать доступ из внешней сети
- Код задач выполняется в том же окружении, что и основное приложение
- Будьте осторожны при выполнении кода, который может повлиять на систему

## Ограничения
- Максимальный размер кода задачи: не ограничен
- Время выполнения задачи: не ограничено
- Количество задач: ограничено только свободным местом на диске
- История выполнения: хранится 30 дней

## Устранение неполадок
1. Если задача не запускается:
   - Проверьте лог-файл task_manager.log
   - Убедитесь, что код задачи синтаксически корректен
   - Проверьте права доступа к директории tasks

2. Если приложение не запускается:
   - Убедитесь, что все зависимости установлены
   - Проверьте, не занят ли порт 5000
   - Проверьте права доступа к директории

3. Если история не отображается:
   - Проверьте права доступа к taskmanager.db
   - Убедитесь, что база данных не повреждена

## Логика работы

### 1. Хранение данных
- **taskmanager.db**: SQLite база данных для хранения:
  - Информации о задачах (таблица Task)
  - Истории выполнения (таблица TaskHistory)
- **jobs.sqlite**: База данных APScheduler для хранения расписания

### 2. Создание задачи
1. Пользователь заполняет форму с:
   - Названием задачи
   - Python-кодом
   - Типом расписания и параметрами
2. Код сохраняется в отдельный файл в директории tasks/
3. Информация о задаче сохраняется в базу данных
4. Задача добавляется в планировщик APScheduler

### 3. Выполнение задачи
1. При наступлении времени выполнения:
   - APScheduler вызывает функцию execute_task
   - Создается запись в истории выполнения
   - Выполняется Python-код задачи
   - Результат или ошибка сохраняются в истории
2. При ручном запуске:
   - Процесс аналогичен автоматическому запуску
   - Не влияет на расписание

### 4. История выполнения
- Хранит информацию о каждом выполнении задачи
- Включает:
  - Время начала и окончания
  - Статус выполнения
  - Вывод программы или сообщение об ошибке
- Автоматически очищается через 30 дней

## Примечания
- Все задачи сохраняются между перезапусками сервера
- Расписание автоматически восстанавливается при запуске
- Логи работы сохраняются в task_manager.log
- При удалении задачи удаляются все связанные данные
- Рекомендуется периодически делать резервные копии баз данных
- При обновлении приложения сохраняйте копии файлов tasks/ и *.db